<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Emanuel Heitlinger" />

<meta name="date" content="2021-01-17" />

<title>MultiAmplicon - a small example</title>

<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">MultiAmplicon - a small example</h1>
<h4 class="author">Emanuel Heitlinger</h4>
<h4 class="date">2021-01-17</h4>



<div id="preparing-sequencing-read-files-and-a-primer-set" class="section level2">
<h2>Preparing sequencing read files and a primer set</h2>
<p>The MultiAmplicon package uses dedicated classes to ensure that input to its <code>sortAmplicons</code> function is provided correctly. Concerning input files, this means for the user that file names (including paths to the directory they are stored in) of forward and reverse sequencing read files must be provided as a <code>PairedReadFileSet</code>. These files can contain reads in fastq or in gzipped fastq format. We focus as a default use case on (non-interleaved) paired-end reads, as these are the most common format Illumina sequencing reads are currently produced in.</p>
<p>Similarly, primer pairs must be provided in a <code>PrimerPairsSet</code>. We then match forward and reverse primers at the start of forward and reverse reads, respectively. The maximal number of mismatches and the maximal distance from the start of the read can be supplied as arguments to the function. The primer sequences are trimmed from the reads and the read-pair is associated with the amplicon defined by the primer-pair.</p>
<p>We first have a look at how <code>PairedReadFileSet</code> and <code>PrimerPairsSet</code> are generated. Please use files containing quality filtered sequencing reads for the steps below. See the <a href="https://benjjneb.github.io/dada2/tutorial.html">dada2 tutorial</a> or our <a href="https://derele.github.io/MultiAmplicon/articles/MultiAmplicon-real-world-example.html">real-world example vignette</a> for how files are trimmed and quality filtered. But we here first use a very small data set included in the MultiAmplicon package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(MultiAmplicon)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">## we'll also use some dada2 functions directly</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(dada2)</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">fastq.dir &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;fastq&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MultiAmplicon&quot;</span>)</a>
<a class="sourceLine" id="cb1-6" title="6">fastq.files &lt;-<span class="st"> </span><span class="kw">list.files</span>(fastq.dir, <span class="dt">full.names=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8">Ffastq.file &lt;-<span class="st"> </span>fastq.files[<span class="kw">grepl</span>(<span class="st">&quot;F_filt&quot;</span>, fastq.files)]</a>
<a class="sourceLine" id="cb1-9" title="9">Rfastq.file &lt;-<span class="st"> </span>fastq.files[<span class="kw">grepl</span>(<span class="st">&quot;R_filt&quot;</span>, fastq.files)]</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">names</span>(Rfastq.file) &lt;-<span class="st"> </span><span class="kw">names</span>(Ffastq.file) &lt;-</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;_F_filt</span><span class="ch">\\</span><span class="st">.fastq</span><span class="ch">\\</span><span class="st">.gz&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">basename</span>(Ffastq.file))</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14">PRF &lt;-<span class="st"> </span><span class="kw">PairedReadFileSet</span>(Ffastq.file, Rfastq.file)</a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16">primerF &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Amp1F =</span> <span class="st">&quot;AGAGTTTGATCCTGGCTCAG&quot;</span>, <span class="dt">Amp2F =</span> <span class="st">&quot;ACTCCTACGGGAGGCAGC&quot;</span>,</a>
<a class="sourceLine" id="cb1-17" title="17">             <span class="dt">Amp3F =</span> <span class="st">&quot;GAATTGACGGAAGGGCACC&quot;</span>, <span class="dt">Amp4F =</span> <span class="st">&quot;YGGTGRTGCATGGCCGYT&quot;</span>,</a>
<a class="sourceLine" id="cb1-18" title="18">             <span class="dt">Amp5F =</span> <span class="st">&quot;AAAAACCCCGGGGGGTTTTT&quot;</span>, <span class="dt">Amp6F =</span> <span class="st">&quot;AGAGTTTGATCCTGCCTCAG&quot;</span>)</a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20">primerR &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Amp1R =</span> <span class="st">&quot;CTGCWGCCNCCCGTAGG&quot;</span>, <span class="dt">Amp2R =</span> <span class="st">&quot;GACTACHVGGGTATCTAATCC&quot;</span>,</a>
<a class="sourceLine" id="cb1-21" title="21">             <span class="dt">Amp3R =</span> <span class="st">&quot;AAGGGCATCACAGACCTGTTAT&quot;</span>, <span class="dt">Amp4R =</span> <span class="st">&quot;TCCTTCTGCAGGTTCACCTAC&quot;</span>,</a>
<a class="sourceLine" id="cb1-22" title="22">             <span class="dt">Amp5R =</span> <span class="st">&quot;AAAAACCCCGGGGGGTTTTT&quot;</span>, <span class="dt">Amp6R =</span> <span class="st">&quot;CCTACGGGTGGCAGATGCAG&quot;</span>)</a>
<a class="sourceLine" id="cb1-23" title="23"></a>
<a class="sourceLine" id="cb1-24" title="24">PPS &lt;-<span class="st"> </span><span class="kw">PrimerPairsSet</span>(primerF, primerR)</a>
<a class="sourceLine" id="cb1-25" title="25"></a>
<a class="sourceLine" id="cb1-26" title="26">MA &lt;-<span class="st"> </span><span class="kw">MultiAmplicon</span>(PPS, PRF)</a></code></pre></div>
<p>Note that the primer pairs in the <code>PrimerPairsSet</code> can be named and the same also is true for the sequencing read file pairs (although not in our example above). This results in names for primer-pairs and for samples.</p>
</div>
<div id="sorting-into-multiple-amplicons" class="section level2">
<h2>Sorting into multiple amplicons</h2>
<p>Based on the primer sequences we can now sort the sequences into amplicons. This is done by the function <code>sortAmplicons</code>, which updates the MultiAmplicon object with the sorted amplicons.</p>
<p>For this small example data set we can look at the resulting <code>rawCounts</code> (function <code>getRawCounts</code>) i.e. the number of sequences for each of the fully stratified amplicon x sample matrix.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">MA1 &lt;-<span class="st"> </span><span class="kw">sortAmplicons</span>(MA, <span class="dt">filedir=</span><span class="kw">tempfile</span>(<span class="st">&quot;dir&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">getRawCounts</span>(MA1))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">S00</th>
<th align="right">S01</th>
<th align="right">S02</th>
<th align="right">S03</th>
<th align="right">S04</th>
<th align="right">S05</th>
<th align="right">S05D</th>
<th align="right">S06</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Amp1F.Amp1R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3495</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">29310</td>
<td align="right">29310</td>
<td align="right">2569</td>
</tr>
<tr class="even">
<td align="left">Amp2F.Amp2R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2949</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">20391</td>
<td align="right">20391</td>
<td align="right">2690</td>
</tr>
<tr class="odd">
<td align="left">Amp3F.Amp3R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1817</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">11671</td>
</tr>
<tr class="even">
<td align="left">Amp4F.Amp4R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1087</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">2076</td>
<td align="right">2076</td>
<td align="right">428</td>
</tr>
<tr class="odd">
<td align="left">Amp5F.Amp5R</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Amp6F.Amp6R</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="visualizing-read-numbers-per-amplicon-and-filtering-based-on-these" class="section level2">
<h2>Visualizing read numbers per amplicon and filtering based on these</h2>
<p>Now we can plot the result. The function plotAmpliconNumbers allows us also to store clustering information (see <a href="https://www.rdocumentation.org/packages/pheatmap/versions/0.2/topics/pheatmap"></a>). Which can afterwards be used to filter data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">clusters &lt;-<span class="st"> </span><span class="kw">plotAmpliconNumbers</span>(MA1)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can use this clustering information now to subset our MultiAmplicon object.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">two.clusters.row &lt;-<span class="st"> </span><span class="kw">cutree</span>(clusters<span class="op">$</span>tree_row, <span class="dt">k=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">two.clusters.col &lt;-<span class="st"> </span><span class="kw">cutree</span>(clusters<span class="op">$</span>tree_col, <span class="dt">k=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">knitr<span class="op">::</span><span class="kw">kable</span>(two.clusters.row)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Amp1F.Amp1R</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Amp2F.Amp2R</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Amp3F.Amp3R</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Amp4F.Amp4R</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Amp5F.Amp5R</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Amp6F.Amp6R</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">knitr<span class="op">::</span><span class="kw">kable</span>(two.clusters.col)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">S00</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">S01</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">S02</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">S03</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">S04</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">S05</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">S05D</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">S06</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">MA.sub &lt;-<span class="st"> </span>MA1[<span class="kw">which</span>(two.clusters.row<span class="op">==</span><span class="dv">1</span>), <span class="kw">which</span>(two.clusters.col<span class="op">==</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">getRawCounts</span>(MA.sub))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">S02</th>
<th align="right">S05</th>
<th align="right">S05D</th>
<th align="right">S06</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Amp1F.Amp1R</td>
<td align="right">3495</td>
<td align="right">29310</td>
<td align="right">29310</td>
<td align="right">2569</td>
</tr>
<tr class="even">
<td align="left">Amp2F.Amp2R</td>
<td align="right">2949</td>
<td align="right">20391</td>
<td align="right">20391</td>
<td align="right">2690</td>
</tr>
<tr class="odd">
<td align="left">Amp4F.Amp4R</td>
<td align="right">1087</td>
<td align="right">2076</td>
<td align="right">2076</td>
<td align="right">428</td>
</tr>
</tbody>
</table>
<p>In real world applications (see <a href="https://derele.github.io/MultiAmplicon/articles/MultiAmplicon-real-world-example.html">our other vignette</a>) the samples to be excluded from further analysis can be selected based on clustering with negative controls (similar to the example data here where S00 is an empty file and S01 contains one sequence).</p>
</div>
<div id="running-the-amplicon-sequencing-pipeline" class="section level2">
<h2>Running the amplicon sequencing pipeline</h2>
<p>We first estimate the errors separately for both for dada’s probabilistic sequence variant inference. We do this here on the combined stratified files for different amplicons. This should be done separately for forward ad reverse sequence though!</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">errF &lt;-<span class="st"> </span><span class="kw">learnErrors</span>(<span class="kw">unlist</span>(<span class="kw">getStratifiedFilesF</span>(MA1)), <span class="dt">verbose=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-2" title="2">errR &lt;-<span class="st"> </span><span class="kw">learnErrors</span>(<span class="kw">unlist</span>(<span class="kw">getStratifiedFilesR</span>(MA1)), <span class="dt">verbose=</span><span class="dv">0</span>)</a></code></pre></div>
<p>We can now run the pipeline of the dada2 package in parallel over the different amplicons. We update our object from each previous step and safe it under a new name, here for illustration. In your own workflow you can also overwrite the old object.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">MA3 &lt;-<span class="st"> </span><span class="kw">dadaMulti</span>(MA1, <span class="dt">Ferr=</span>errF, <span class="dt">Rerr=</span>errR,  <span class="dt">pool=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&gt; Sample 1 - 3495 reads in 1493 unique sequences.</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#&gt; Sample 2 - 5 reads in 5 unique sequences.</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt; Sample 3 - 5 reads in 5 unique sequences.</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; Sample 4 - 29310 reads in 7224 unique sequences.</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt; Sample 5 - 29310 reads in 7224 unique sequences.</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt; Sample 6 - 2569 reads in 1053 unique sequences.</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt; Sample 1 - 3495 reads in 1535 unique sequences.</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt; Sample 2 - 5 reads in 5 unique sequences.</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt; Sample 3 - 5 reads in 4 unique sequences.</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt; Sample 4 - 29310 reads in 8273 unique sequences.</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt; Sample 5 - 29310 reads in 8273 unique sequences.</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt; Sample 6 - 2569 reads in 994 unique sequences.</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt; Sample 1 - 2949 reads in 1142 unique sequences.</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt; Sample 2 - 2 reads in 2 unique sequences.</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt; Sample 3 - 20391 reads in 4136 unique sequences.</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; Sample 4 - 20391 reads in 4136 unique sequences.</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; Sample 5 - 2690 reads in 968 unique sequences.</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt; Sample 1 - 2949 reads in 1290 unique sequences.</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; Sample 2 - 2 reads in 2 unique sequences.</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; Sample 3 - 20391 reads in 5719 unique sequences.</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt; Sample 4 - 20391 reads in 5719 unique sequences.</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; Sample 5 - 2690 reads in 1100 unique sequences.</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt; Sample 1 - 1817 reads in 589 unique sequences.</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt; Sample 2 - 11671 reads in 3783 unique sequences.</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co">#&gt; Sample 1 - 1817 reads in 547 unique sequences.</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">#&gt; Sample 2 - 11671 reads in 4054 unique sequences.</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt; Sample 1 - 1087 reads in 394 unique sequences.</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt; Sample 2 - 7 reads in 6 unique sequences.</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co">#&gt; Sample 3 - 2076 reads in 959 unique sequences.</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co">#&gt; Sample 4 - 2076 reads in 959 unique sequences.</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co">#&gt; Sample 5 - 428 reads in 166 unique sequences.</span></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt; Sample 1 - 1087 reads in 433 unique sequences.</span></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="co">#&gt; Sample 2 - 7 reads in 5 unique sequences.</span></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">#&gt; Sample 3 - 2076 reads in 962 unique sequences.</span></a>
<a class="sourceLine" id="cb9-36" title="36"><span class="co">#&gt; Sample 4 - 2076 reads in 962 unique sequences.</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">#&gt; Sample 5 - 428 reads in 183 unique sequences.</span></a>
<a class="sourceLine" id="cb9-38" title="38"></a>
<a class="sourceLine" id="cb9-39" title="39">MA4 &lt;-<span class="st"> </span><span class="kw">mergeMulti</span>(MA3, <span class="dt">justConcatenate=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-40" title="40"></a>
<a class="sourceLine" id="cb9-41" title="41">MA5 &lt;-<span class="st"> </span><span class="kw">makeSequenceTableMulti</span>(MA4)</a>
<a class="sourceLine" id="cb9-42" title="42"></a>
<a class="sourceLine" id="cb9-43" title="43">MA6 &lt;-<span class="st"> </span><span class="kw">removeChimeraMulti</span>(MA5, <span class="dt">mc.cores=</span><span class="dv">1</span>)</a></code></pre></div>
<p>The steps after <code>sortAmplcions</code> until <code>removeChimeraMulti</code> recapitulate different processes in the <a href="https://benjjneb.github.io/dada2/tutorial.html">dada2 pipeline</a>.</p>
</div>
<div id="a-word-on-dada2-sequence-inference" class="section level2">
<h2>A word on dada2 sequence inference</h2>
<p>The above workflow assumes that errors could be estimated for each amplicon together. This would be beneficial if errors were largely similar between different amplicons (i.e. not influenced by the primer sequence comprising the first bases the original sequence). Below an alternative approach is demonstrated with error probabilities estimated separately for each amplicon (here we also overwrite objects from each previous processing steps).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">MA.alt &lt;-<span class="st"> </span><span class="kw">dadaMulti</span>(MA3, <span class="dt">selfConsist=</span><span class="ot">TRUE</span>, <span class="dt">pool=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt; selfConsist step 1 ......</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&gt;    selfConsist step 6</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&gt; Convergence after  6  rounds.</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&gt; selfConsist step 1 ......</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; Convergence after  5  rounds.</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; selfConsist step 1 .....</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt;    selfConsist step 6</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; Convergence after  6  rounds.</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; selfConsist step 1 .....</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="co">#&gt; Convergence after  5  rounds.</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="co">#&gt; selfConsist step 1 ..</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-38" title="38"><span class="co">#&gt; Convergence after  5  rounds.</span></a>
<a class="sourceLine" id="cb10-39" title="39"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-40" title="40"><span class="co">#&gt; selfConsist step 1 ..</span></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-42" title="42"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-44" title="44"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-45" title="45"><span class="co">#&gt; Convergence after  5  rounds.</span></a>
<a class="sourceLine" id="cb10-46" title="46"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-47" title="47"><span class="co">#&gt; selfConsist step 1 .....</span></a>
<a class="sourceLine" id="cb10-48" title="48"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-49" title="49"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-50" title="50"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-51" title="51"><span class="co">#&gt;    selfConsist step 5</span></a>
<a class="sourceLine" id="cb10-52" title="52"><span class="co">#&gt; Convergence after  5  rounds.</span></a>
<a class="sourceLine" id="cb10-53" title="53"><span class="co">#&gt; Initializing error rates to maximum possible estimate.</span></a>
<a class="sourceLine" id="cb10-54" title="54"><span class="co">#&gt; selfConsist step 1 .....</span></a>
<a class="sourceLine" id="cb10-55" title="55"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb10-56" title="56"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb10-57" title="57"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb10-58" title="58"><span class="co">#&gt; Convergence after  4  rounds.</span></a>
<a class="sourceLine" id="cb10-59" title="59"></a>
<a class="sourceLine" id="cb10-60" title="60">MA.alt &lt;-<span class="st"> </span><span class="kw">mergeMulti</span>(MA.alt, <span class="dt">justConcatenate=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-61" title="61"></a>
<a class="sourceLine" id="cb10-62" title="62">MA.alt &lt;-<span class="st"> </span><span class="kw">makeSequenceTableMulti</span>(MA.alt)</a>
<a class="sourceLine" id="cb10-63" title="63"></a>
<a class="sourceLine" id="cb10-64" title="64">MA.alt &lt;-<span class="st"> </span><span class="kw">removeChimeraMulti</span>(MA.alt, <span class="dt">mc.cores=</span><span class="dv">1</span>)</a></code></pre></div>
<p>Now we can make a comparison between the two different versions:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">together &lt;-<span class="st"> </span><span class="kw">getSequencesFromTable</span>(MA6)</a>
<a class="sourceLine" id="cb11-2" title="2">alt &lt;-<span class="st"> </span><span class="kw">getSequencesFromTable</span>(MA.alt)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">lapply</span>(<span class="kw">seq_along</span>(together), <span class="cf">function</span> (i){</a>
<a class="sourceLine" id="cb11-5" title="5">  union &lt;-<span class="st"> </span><span class="kw">union</span>(alt[[i]], together[[i]])</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">table</span>(<span class="st">&quot;combined Inference&quot;</span>=union<span class="op">%in%</span>together[[i]],</a>
<a class="sourceLine" id="cb11-7" title="7">        <span class="st">&quot;seperate amplicon&quot;</span>=union<span class="op">%in%</span>alt[[i]])</a>
<a class="sourceLine" id="cb11-8" title="8">})</a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt;                   seperate amplicon</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt; combined Inference FALSE TRUE</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt;              FALSE     0    6</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt;              TRUE      3  219</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt;                   seperate amplicon</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt; combined Inference FALSE TRUE</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co">#&gt;              FALSE     0   11</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co">#&gt;              TRUE      6  153</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="co">#&gt;                   seperate amplicon</span></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co">#&gt; combined Inference FALSE TRUE</span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="co">#&gt;              FALSE     0    2</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="co">#&gt;              TRUE      1  157</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-27" title="27"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="co">#&gt;                   seperate amplicon</span></a>
<a class="sourceLine" id="cb11-29" title="29"><span class="co">#&gt; combined Inference FALSE TRUE</span></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="co">#&gt;              FALSE     0    2</span></a>
<a class="sourceLine" id="cb11-31" title="31"><span class="co">#&gt;              TRUE      8  116</span></a>
<a class="sourceLine" id="cb11-32" title="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-33" title="33"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb11-34" title="34"><span class="co">#&gt; &lt; table of extent 0 x 0 &gt;</span></a>
<a class="sourceLine" id="cb11-35" title="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-36" title="36"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb11-37" title="37"><span class="co">#&gt; &lt; table of extent 0 x 0 &gt;</span></a></code></pre></div>
<p>So for all amplicons we got very similar output, the overwhelming majority of ASVs was found using both methods. This speaks for error rates not differing between amplicons (and for the robustness of the ASV inference of the amazing dada2). Which method you should use depends on your data: if each amplicon has enough reads you can estimate seperately and potentially get a better estimate of errors for amplicons with different errors. If on the other hand some amplicons have very few reads, it might make sense to pool them to improve error estimates with larger size for the training set.</p>
</div>
<div id="using-different-parameters-for-each-amplicon" class="section level2">
<h2>Using different parameters for each amplicon</h2>
<p>In some real world applications it might be desirable to have more control over parameters used in the pipeline for different amplicons.</p>
<p>We use ellipsis (aka “…”, dots, dot-dot-dot or three-dots) to pass parameters on to the underlying dada2 functions. The MultiAmplicon package allows all those arguments to be vectors with values varying for different amplicons.</p>
<p>Let’s suppose for this we e.g. want to merge a subset of our amplicons, while we concatenate others (with Ns between forward and reverser reads).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">MA.mixed &lt;-<span class="st"> </span><span class="kw">mergeMulti</span>(MA3, <span class="dt">justConcatenate=</span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; merging sequences from 6 samples for amplicon Amp1F.Amp1R</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; calling mergePairs with justConcatenate=TRUE parameters</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; merging sequences from 5 samples for amplicon Amp2F.Amp2R</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; calling mergePairs with justConcatenate=FALSE parameters</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; merging sequences from 2 samples for amplicon Amp3F.Amp3R</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; calling mergePairs with justConcatenate=FALSE parameters</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; merging sequences from 5 samples for amplicon Amp4F.Amp4R</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; calling mergePairs with justConcatenate=TRUE parameters</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; merging sequences from 0 samples for amplicon Amp5F.Amp5R</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; calling mergePairs with justConcatenate=FALSE parameters</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; merging sequences from 0 samples for amplicon Amp6F.Amp6R</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt; calling mergePairs with justConcatenate=FALSE parameters</span></a></code></pre></div>
<p>The above example would make sense if (only) amplicons Amp1F.Amp1R and Amp4F.Amp4R (1st and 4th in our object) had too little overlap between forward and reverse reads to be merged and would better be concatenated. Btw: Here this makes not really sense as to much sequences for the 2nd and 3rd amplicon don’t merge for this dataset.</p>
<p>Coming back to our example on dada sequence inference, we could also mix err estimates to use errors either seperately or accross amplicons. Always set the references to both pre-computed error parameters <code>NULL</code> when using self consistent estimation within one amplicon.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">MA.mixed &lt;-<span class="st"> </span><span class="kw">dadaMulti</span>(MA3,</a>
<a class="sourceLine" id="cb13-2" title="2">                      <span class="dt">Ferr=</span><span class="kw">c</span>(<span class="ot">NULL</span>, errF,  <span class="ot">NULL</span>, errF, <span class="ot">NULL</span>, <span class="ot">NULL</span>),</a>
<a class="sourceLine" id="cb13-3" title="3">                      <span class="dt">Rerr=</span><span class="kw">c</span>(<span class="ot">NULL</span>, errR,  <span class="ot">NULL</span>, errR, <span class="ot">NULL</span>, <span class="ot">NULL</span>),</a>
<a class="sourceLine" id="cb13-4" title="4">               <span class="dt">selfConsist=</span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; amplicon Amp1F.Amp1R: dada estimation of sequence variants from 6 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; calling dada with selfConsist=TRUE parameters</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt; selfConsist step 1 ......</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; Convergence after  4  rounds.</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; selfConsist step 1 ......</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="co">#&gt; Convergence after  4  rounds.</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co">#&gt; amplicon Amp2F.Amp2R: dada estimation of sequence variants from 5 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="co">#&gt; calling dada with selfConsist=FALSE parameters</span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#&gt; Sample 1 - 2949 reads in 1142 unique sequences.</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="co">#&gt; Sample 2 - 2 reads in 2 unique sequences.</span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co">#&gt; Sample 3 - 20391 reads in 4136 unique sequences.</span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="co">#&gt; Sample 4 - 20391 reads in 4136 unique sequences.</span></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co">#&gt; Sample 5 - 2690 reads in 968 unique sequences.</span></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="co">#&gt; Sample 1 - 2949 reads in 1290 unique sequences.</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="co">#&gt; Sample 2 - 2 reads in 2 unique sequences.</span></a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co">#&gt; Sample 3 - 20391 reads in 5719 unique sequences.</span></a>
<a class="sourceLine" id="cb13-31" title="31"><span class="co">#&gt; Sample 4 - 20391 reads in 5719 unique sequences.</span></a>
<a class="sourceLine" id="cb13-32" title="32"><span class="co">#&gt; Sample 5 - 2690 reads in 1100 unique sequences.</span></a>
<a class="sourceLine" id="cb13-33" title="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-35" title="35"><span class="co">#&gt; amplicon Amp3F.Amp3R: dada estimation of sequence variants from 2 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-36" title="36"><span class="co">#&gt; calling dada with selfConsist=TRUE parameters</span></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="co">#&gt; selfConsist step 1 ..</span></a>
<a class="sourceLine" id="cb13-38" title="38"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb13-39" title="39"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb13-40" title="40"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb13-41" title="41"><span class="co">#&gt; Convergence after  4  rounds.</span></a>
<a class="sourceLine" id="cb13-42" title="42"><span class="co">#&gt; selfConsist step 1 ..</span></a>
<a class="sourceLine" id="cb13-43" title="43"><span class="co">#&gt;    selfConsist step 2</span></a>
<a class="sourceLine" id="cb13-44" title="44"><span class="co">#&gt;    selfConsist step 3</span></a>
<a class="sourceLine" id="cb13-45" title="45"><span class="co">#&gt;    selfConsist step 4</span></a>
<a class="sourceLine" id="cb13-46" title="46"><span class="co">#&gt; Convergence after  4  rounds.</span></a>
<a class="sourceLine" id="cb13-47" title="47"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-48" title="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-49" title="49"><span class="co">#&gt; amplicon Amp4F.Amp4R: dada estimation of sequence variants from 5 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-50" title="50"><span class="co">#&gt; calling dada with selfConsist=FALSE parameters</span></a>
<a class="sourceLine" id="cb13-51" title="51"><span class="co">#&gt; Sample 1 - 1087 reads in 394 unique sequences.</span></a>
<a class="sourceLine" id="cb13-52" title="52"><span class="co">#&gt; Sample 2 - 7 reads in 6 unique sequences.</span></a>
<a class="sourceLine" id="cb13-53" title="53"><span class="co">#&gt; Sample 3 - 2076 reads in 959 unique sequences.</span></a>
<a class="sourceLine" id="cb13-54" title="54"><span class="co">#&gt; Sample 4 - 2076 reads in 959 unique sequences.</span></a>
<a class="sourceLine" id="cb13-55" title="55"><span class="co">#&gt; Sample 5 - 428 reads in 166 unique sequences.</span></a>
<a class="sourceLine" id="cb13-56" title="56"><span class="co">#&gt; Sample 1 - 1087 reads in 433 unique sequences.</span></a>
<a class="sourceLine" id="cb13-57" title="57"><span class="co">#&gt; Sample 2 - 7 reads in 5 unique sequences.</span></a>
<a class="sourceLine" id="cb13-58" title="58"><span class="co">#&gt; Sample 3 - 2076 reads in 962 unique sequences.</span></a>
<a class="sourceLine" id="cb13-59" title="59"><span class="co">#&gt; Sample 4 - 2076 reads in 962 unique sequences.</span></a>
<a class="sourceLine" id="cb13-60" title="60"><span class="co">#&gt; Sample 5 - 428 reads in 183 unique sequences.</span></a>
<a class="sourceLine" id="cb13-61" title="61"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-62" title="62"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-63" title="63"><span class="co">#&gt; amplicon Amp5F.Amp5R: dada estimation of sequence variants from 0 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-64" title="64"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-65" title="65"><span class="co">#&gt; skipping empty amplicon</span></a>
<a class="sourceLine" id="cb13-66" title="66"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-67" title="67"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-68" title="68"><span class="co">#&gt; amplicon Amp6F.Amp6R: dada estimation of sequence variants from 0 of 8 possible sample files</span></a>
<a class="sourceLine" id="cb13-69" title="69"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-70" title="70"><span class="co">#&gt; skipping empty amplicon</span></a></code></pre></div>
</div>
<div id="taxnomic-annotation" class="section level2">
<h2>Taxnomic annotation</h2>
<p>Taxonimical annotation is difficult as for 18S markers reference databases are not as mature as for 16S. As we use Multiamplicon in our own research it includes for now only a 18S annotation via BLAST+. This only works on UNIX systems with the NCBI BLAST+ toolkit installed. In addition we have to build a <a href="https://github.com/sherrillmix/taxonomizr">taxonomizr</a> database.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co">## echo=TRUE for this?</span></a>
<a class="sourceLine" id="cb14-2" title="2">inputFasta &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;in.fasta&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MultiAmplicon&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3">outputBlast &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;out.blt&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MultiAmplicon&quot;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5">MA7 &lt;-<span class="st"> </span><span class="kw">blastTaxAnnot</span>(MA6, <span class="dt">db=</span><span class="st">&quot;/SAN/db/blastdb/nt/nt&quot;</span>,</a>
<a class="sourceLine" id="cb14-6" title="6">                     <span class="dt">negative_gilist =</span> <span class="st">&quot;/SAN/db/blastdb/uncultured_gilist.txt&quot;</span>,</a>
<a class="sourceLine" id="cb14-7" title="7">                     <span class="dt">taxonSQL=</span><span class="st">&quot;/SAN/db/taxonomy/taxonomizr.sql&quot;</span>, <span class="dt">num_threads=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb14-8" title="8">                     <span class="dt">infasta =</span> inputFasta,</a>
<a class="sourceLine" id="cb14-9" title="9">                     <span class="dt">outblast =</span> outputBlast)</a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">#&gt; file /tmp/RtmpSMMAU7/temp_libpath163e9560f2022/MultiAmplicon/extdata/in.fasta exists, using existing file! To extract input sequences for blast  again delete the file</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">#&gt; file/tmp/RtmpSMMAU7/temp_libpath163e9560f2022/MultiAmplicon/extdata/out.blt exists, using existing file! To run blast again delete file</span></a></code></pre></div>
<p>In the above code you have to adjust the path’s for the BLAST and taxonomizr databases.</p>
</div>
<div id="handing-over-to-phyloseq" class="section level2">
<h2>Handing over to phyloseq</h2>
<p>The <a href="https://github.com/sherrillmix/taxonomizr">phyloseq</a> package provides impressive tools for microbiome data handling and analysis. We can now convert our MultiAmpicon object into a phlyoseq object.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co">## echo=TRUE for this?</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">library</span>(phyloseq)</a>
<a class="sourceLine" id="cb15-3" title="3"></a>
<a class="sourceLine" id="cb15-4" title="4">smpls&lt;-<span class="st"> </span>MA7<span class="op">@</span>colnames</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="kw">colnames</span>(MA7)</a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb15-8" title="8"></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> vignette samples:&quot;</span>, smpls, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt;  vignette samples: S00 S01 S02 S03 S04 S05 S05D S06</span></a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> vignette rownames:&quot;</span>, <span class="kw">colnames</span>(MA7), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="co">#&gt;  vignette rownames:</span></a>
<a class="sourceLine" id="cb15-16" title="16"></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co">## PHY &lt;- toPhyloseq(MA7, samples=smpls, multi2Single=TRUE)</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="co">## PHY.list &lt;- toPhyloseq(MA7, samples=smpls, multi2Single=FALSE)</span></a>
<a class="sourceLine" id="cb15-19" title="19"><span class="co">## PHYgenus &lt;- tax_glom(PHY, &quot;genus&quot;)</span></a>
<a class="sourceLine" id="cb15-20" title="20"></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="co">## knitr::kable(table(tax_table(PHYgenus)[, &quot;superkingdom&quot;]))</span></a>
<a class="sourceLine" id="cb15-22" title="22"><span class="co">## knitr::kable(table(tax_table(PHYgenus)[, &quot;phylum&quot;]))</span></a></code></pre></div>
<p>The <code>multi2Single</code> option controls…</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">## PHYWO &lt;- toPhyloseq(MA6, samples=colnames(MA6))</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co">## PHYWO.list &lt;- toPhyloseq(MA6, samples=colnames(MA6), multi2Single=FALSE)</span></a>
<a class="sourceLine" id="cb16-3" title="3"></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> for some strange reason toPhyloseq fails in the vignette building,</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">but works in iteractive sessions... have to investigate this later.&quot;</span>)</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">#&gt;  for some strange reason toPhyloseq fails in the vignette building,</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">#&gt; but works in iteractive sessions... have to investigate this later.</span></a>
<a class="sourceLine" id="cb16-9" title="9"></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">### reminder: I should really look into something like showMethods(&quot;sample_names&quot;)</span></a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
